<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Weather CLI Installer</title>
        <link rel="stylesheet" href="bootstrap/css/bootstrap.css">
        <script src="bootstrap/js/bootstrap.min.js"></script>
        <style>
            body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; }
            .pad {
            margin-left: 10px;
            margin-right: 10px;
            margin-top: 10px;
            }
        </style>
    </head>
    <body>
        <div id="liveAlertPlaceholder"></div>
        <h1 style="text-align: center">Install Weather CLI</h1>
        <form class="pad" style="width: 50%">
            <div class="col-md-12">
                <label for="installDir" class="form-label">Installation Directory</label>
                <input type="text" class="form-control" id="installDir" >
            </div>
        </form>
        <div class="pad">
            <button type="button" class="btn btn-primary" id="install" onclick="install()">Install</button>
        </div>
        <div class="pad">
            <div id="progress" class="progress">
                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div>
            </div>
        </div>
        <div class="toast-container position-static" id="toasts">
        </div>
        <script>
            // -------------------------------
            // Toasts
            // -------------------------------
            const toastPlacement = document.getElementById('toastPlacement')
            if (toastPlacement) {
                document.getElementById('selectToastPlacement').addEventListener('change', function () {
                if (!toastPlacement.dataset.originalClass) {
                    toastPlacement.dataset.originalClass = toastPlacement.className
                }
                toastPlacement.className = `${toastPlacement.dataset.originalClass} ${this.value}`

                })
            }


            // -------------------------------
            // Alerts
            // -------------------------------
            const alertPlaceholder = document.getElementById('liveAlertPlaceholder')

            const appendAlert = (message, type) => {
            const wrapper = document.createElement('div')
                wrapper.innerHTML = [
                `<div class="alert alert-${type} alert-dismissible" role="alert">`,
                `   <div>${message}</div>`,
                '   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>',
                '</div>'
                ].join('')
                alertPlaceholder.append(wrapper)
            }


            // -------------------------------
            // Modal
            // -------------------------------
            // Modal 'Varying modal content' example in docs and StackBlitz
            const modal = document.getElementById('modal')
            if (modal) {
                modal.addEventListener('show.bs.modal', event => {
                    // Button that triggered the modal
                    const button = event.relatedTarget
                    // Extract info from data-bs-* attributes
                    const recipient = button.getAttribute('data-bs-whatever')

                    // Update the modal's content.
                    const modalTitle = modal.querySelector('.modal-title')
                    const modalBodyInput = modal.querySelector('.modal-body input')

                    modalTitle.textContent = `New message to ${recipient}`
                    modalBodyInput.value = recipient
                })
              }

            const {invoke} = window.__TAURI__.tauri
            invoke('get_default_path_wrap', {}).then(function(resp) {document.getElementById("installDir").value = resp})
            document.getElementById("progress").hidden = true;


            function install() {
                let installbtn = document.getElementById("install");
                let installDir = document.getElementById("installDir");
                document.getElementById("progress").hidden = false;
                installbtn.disabled = true;
                installDir.disabled = true;
                let path = installDir.value;
                console.info("Installing at " + path);
                // access the pre-bundled global API functions
                const {invoke} = window.__TAURI__.tauri
                let r = invoke('install', {path}).then(
                    function (resp) {
                        console.log(resp)
                        installbtn.disabled = false;
                        installDir.disabled = false;
                        document.getElementById("progress").hidden = true;
                        if (resp === "success") {
                            appendAlert('Weathercli Successfully Installed', 'success');
                        }
                        else {
                            appendAlert('Installation Failed', 'primary');
                        }
                    });
            }
        </script>
    </body>
</html>
